<!DOCTYPE html>
<html>
<head>
<title>http request test forms</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
<script type="text/javascript">

onerror=function handleErr( msg, url, l )
{
	txt = "";
	txt+="msg=" + msg + "&";
	txt+="url=" + url + "&";
	txt+="line=" + l + "&";
	alert( txt );
	return true;
}

	$().ready(function(){
		$("#usermessage").submit(function() {
			$("#results").prepend(
				"<div><a href=\"" + "update.php?"+$(this).serialize() + "\">simulate chat</a></div>" );
			return false;
		});
		
		$("#userconnect").submit(function() {
				$("#results").prepend(
					"<div><a href=\"" + "update.php?"+$(this).serialize()+"\">simulate connection</a></div>");
				return false;
			});
			
		$.getJSON("serverlist.php?"/*,{ owner_id : "1" }*/, function(data){
				for ( var i = 0; i < data.length; i++ ) {
					$('select[id][name^="serverip"]').append( new Option( data[i].title ,data[i].ip ));
				}
				
			});
			
		$("#severipedituseraccess").change(function(){
				$.getJSON("playerlist.php?", { serverip: this.value }, function(data){
						$('select[id][name^="serverknown"]').empty();
						//Get player list from server
						for (var i = 0; i < data.length; i++ ){
							$('select[id][name^="serverknown"]').append( new Option( data[i].name, data[i].id ));
						}
					});
			});
			
		$("#serveriphistory").change(function(){
				$.getJSON("history.php?", { serverip: this.value }, function(data){
						//Process data
						$('#chat tbody').empty();
						for (var i = 0; i < data.length; i++){
							$('#chat tbody').append( "<tr><td>" + data[i].timestamp + "</td><td>"+data[i].name + "</td><td>" + data[i].msg +"</td></tr>");
						}

						$("#chat tbody tr:even").addClass("alt");
					});
			});
		$("#refreshserveriphistory").click(function(){
				$("#serveriphistory").trigger("change");
			});
		$("#serverknownusersedituseraccess").change(function(){
				$.getJSON("playerlist.php?", {serverip: $("#severipedituseraccess").val(), userid: this.value},function(data){
						$("form#edituseraccess input:checkbox").removeAttr("checked");
						
						for (var i = 0; i < data.length; i++) {
							if (data[i].value == "true") {
								$("#edituseraccess"+data[i].permission).attr("checked","checked");
							}							
						}
					});
			});
	});
</script>
<style type="text/css">
	#results{
		border: 2px solid red;
	}

	tr.alt td{
		background: #ecf6fc;
	}

	tr.alt td{
		background: #bcd4ec;
	}

	#chat thead td{
		background: #0D5995;
	}


</style>
</head>
<body>
<div>
<fieldset>
<legend>Simulate Chat</legend>
<form id="usermessage">
<input type="hidden" name="action" value="message" />
<label for="serveripmessage">Server</label><select id="serveripmessage" name="serverip"></select>
<label for="playermessage">Player</label><input type="text" id="playermessage" name="player" value="cppmonkey" />
<label for="message">Message</label><input type="text" id="message" name="message" value="Ajax test" />
<input type="submit" />
</form>
</fieldset>
<fieldset>
<legend>Simulate Connection</legend>
<form id="userconnect">
<input type="hidden" name="action" value="connect" />
<label for="serveripconnect">Server</label><select id="serveripconnect" name="serverip"></select>
<label for="playerconnect">Player</label><input type="text" id="playerconnect" name="player" value="cppmonkey" />
<label for="isVip">isVip</label><input type="checkbox" id="isVip" name="vip" />
<label for="isAdmin">isAdmin</label><input type="checkbox" id="isAdmin" name="admin" />
<input type="submit" />
</form>
</fieldset>
<fieldset>
<legend>Simulate Modify</legend>
<form id="usermodify">
<input type="hidden" name="action" value="modify" />
<label for="serveripconnect">Server</label><select id="serveripconnect" name="serverip"></select>
<label for="playerconnect">Player</label><input type="text" id="playerconnect" name="player" value="cppmonkey" />
<label for="type">Add or Remove</label><input type="radio" id="type" name="type" value="add" text="Add" /><input type="radio" id="type" name="type" value="remove" text="Remove" />
<input type="submit" />
</form>
</fieldset>
<legend>Simulate Server Start</legend>
<form id="serverstart">
<input type="hidden" name="action" value="update" />
<label for="serveripconnect">Server</label><select id="serveripconnect" name="serverip"></select>
<label for="playerconnect">Player</label><input type="text" id="playerconnect" name="player" value="cppmonkey" />
<label for="type">Add or Remove</label><input type="radio" id="type" name="type" value="add" text="Add" /><input type="radio" id="type" name="type" value="remove" text="Remove" />
<input type="submit" />
</form>
</fieldset>
<fieldset>
<legend>Add User</legend>
<form id="adduser">
<input type="hidden" name="action" value="" />
<select id="severipadduser" name="serverip"></select>
</form>
</fieldset>
<fieldset>
<legend>Edit User Access</legend>
<form id="edituseraccess">
<input type="hidden" name="action" value="" />
<select id="severipedituseraccess" name="serverip"></select>
<select id="serverknownusersedituseraccess" name="serverknownusers" size="7" multiple="multiple"></select>
<label for="">isVip</label><input id="edituseraccessisVip" name="isVip" type="checkbox" />
<label for="">isAdmin</label><input id="edituseraccessisAdmin" name="isAdmin" type="checkbox" />
<label for="">canBuild</label><input id="edituseraccesscanBuild" name="canBuild" type="checkbox" />
<label for="">canIgnite</label><input id="edituseraccesscanIgnite" name="canIgnite" type="checkbox" />
<input type="submit" />
</form>
</fieldset>
</div>
<div>
<form id="serverhistory">
<label for="serveriphistory">Server</label><select id="serveriphistory" name="serveriphistory"></select><input type="button" id="refreshserveriphistory" value="Refresh"></input>
</form>
</div>
<div id="results" class="results">
	<table id="chat">
	<thead>
	<tr>
	<td>Date/Time</td><td>Name</td>
	<td>Message</td>
	</tr>
	</thead>
	<tbody>
	</tbody>
	</table>
	<div id="users"></div>
</div>
</body>
</html>